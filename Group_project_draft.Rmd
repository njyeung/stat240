---
title: "Group_project_draft"
author: "Cody.ke"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## R Markdown
```
The R Markdown file should include a section in which you read in the raw data files and transform the data for analysis. Exclude this R code from the knitted HTML report by using include=FALSE in the corresponding R chunks.
Your data analysis should include data exploration including graphical and numerical summaries which do not appear in the final report. You may exclude such analysis by using include=FALSE in the corresponding R chunks.
The methods of analysis should primarily be methods discussed from the course.
Data
Upload one or more data files that can be read in with code in the R Markdown file to replicate your analysis.
R Markdown
The instructors should be able to knit your document if the file and all of the data files are in the same directory.
HTML Full Report
The knitted HTML document should contain the following sections. There is no limit on the overall length of this document, but the aim is to introduce your question(s) and describe your results concisely and persuasively.

The knitted document should not include any of the code used for the analysis or graphics. (Set echo=FALSE to suppress the code or include=FALSE to suppress both code and output in the R chunks as appropriate.)

Your report should include the following sections.

Introduction
Understanding crime patterns is essential for developing effective public safety strategies and allocating law enforcement resources efficiently. This analysis investigates crime rates affecting male and female victims in Los Angeles between the years 2020-2024. Some of the questions we were curious to look into are how do crime rates for male and female victims compare throughout the years? Are the trends consistent between genders? Are male victim crime rates consistently higher than female victim rates? We hypothesize that while crime rates for both male and female victims will follow similar patterns throughout the years, the rates for male victims will consistently remain higher.




Background
The data for this analysis came from the “Crime Data from 2020 to Present” dataset published by the Los Angeles Police Department (LAPD) on the City of Los Angeles open data portal. The dataset records crime incidents in Los Angeles beginning in 2020 and is publicly downloadable. We specifically chose to focus on the comparison between the data from 2020 and 2022 because we made a general graph to see trends of crime rates over the years, and there was an obvious increasing trend from 2020 to 2022 which made us want to focus on an even more specific question of comparing crime rates for different genders within those two years to see if we can find something interesting.





Data collection & structure
The data is structured that each row in the dataset represents a single reported crime incident. After filtering out partial 2024 data, the dataset contains 870,696 crime records spanning from 2020 to 2023.

The dataset contains 28 variables which are in separate columns including the variables below that are being focused on in our project: 
DR_NO – a unique record number for each report. 
Date Rptd – the date the crime was reported to police. 
DATE OCC – the date the crime occurred. 
TIME OCC – the time (in 24‑hour format) when the crime occurred. 
Victim gender (sex) - male or female or nonbinary

We later compare crime levels between years by aggregating the data into daily crime counts. Each day becomes one observation, representing the total number of crimes that occurred on that date. 2020 contributes approximately 366 observations (one per day, leap year), and 2022 contributes approximately 365 observations. Even after compression, the sample contains more than enough observations to assume a normal distribution.

We also examine changes in victim gender proportions between 2020 and 2022. The sample sizes for this analysis (given below) are extremely large, therefore we can assume a normal distribution for the z-test.

- 2020 Males: 82157
- 2020 Females: 69333 
- 2022 Males: 95743 
- 2022 Females: 89701

the reason that the dataset is suitable for making a t-test is because there are 366 observations in 2020 which we assign this to n1. And 365 in 2022 which we assign this to n2. n1=>30; n2=>30. so the sample distribution is approximately normal and has high statistical power.so it is large enough to assume a normal approximation so that we can use t-test.

Background / Context of data
This dataset allows researchers and analysts to explore patterns in crime in Los Angeles for example by time, location, type of crime, and victim demographics. Because the data span from 2020 onward, they are especially useful for analyzing recent trends, including potential shifts during the COVID‑19 pandemic, changes in neighborhood crime rates, or demographic patterns in victimization which is what we are focusing on. Being able to examine male and female victim crime rates separately within the same time span allows us to compare them side by side.
Understanding these patterns has practical importance for public safety planning, resource allocation for law enforcement, community interventions, and policy evaluation.



Limitations & factors affecting interpretation
Transcription from paper reports: According to the dataset documentation, the data are transcribed from original LAPD crime reports that were typed on paper, which means human error or transcription errors may exist.


Missing or ambiguous victim details: There may be entries where victim sex or descent is coded as “X” meaning its anonymous or unknown, or victim age is recorded as 0 which would not be reasonable, which can bias or limit analyses by gender or age. 


Reporting vs. occurrence date: The dataset includes both the date of report and the date the crime occurred. Because of potential delays in reporting, analyses based on report date could misrepresent timing. 


Data system changes: As noted by LAPD, starting March 2024 they will adopt a new system (NIBRS), this means the format or completeness of future data may change which is also why we are examining the data between 2020 and 2024 and not further on, eliminating this change in data recording which may cause potential bias.





For the rest of the report, we will be addressing the following:
Filtering the dataset to include only crime incidents from the year 2020 (to match the time frame of interest).
Cleaning and process the data
Analyze and visualize crime rates over time separately for male and female victims (monthly trends across 2020-2024).
Compare patterns between genders to examine our thesis that crime rates for male victims are consistently higher than for female victims, even if overall trends are similar.




Analysis
Include numerical and graphical summaries of the data. Be sure to introduce and describe your numerical and graphical summaries.  Do not display a series of summaries without text explaining them.
Make sure to include at least one graphical display of the data that best supports your main conclusions for your primary question, and explain how it supports your conclusions.
For each inference you make, briefly describe the method you use and what the results are.
Provide evidence to support each of your claims.
This section should not include substantial interpretation of results. Leave that for the discussion.
```

## 0. Data Preprocessing Step
LAPD switched to a new records management system in March 7th 2024 (the number of crimes in this dataset drops significantly after that), so we're going to ignore 2024 in total.

```{r}
crime_data <- read.csv("Crime_Data_from_2020_to_Present.csv")
crime_data <- crime_data %>%
  mutate(
    date = as.Date(substring(Date.Rptd, 1, 10), format = "%m/%d/%Y"),
    year  = year(date),
    month = month(date)
  ) %>%
  arrange(date) %>%
  filter(year < 2024) # drop the year 2024

colnames(crime_data)
```

## 1. Crime Over Time — Has Crime Increased or Decreased?

This plot shows reported crimes per day in LA from 2020 to 2023. The blue curve captures detailed fluctuations, while the red line shows a linear trend across the entire period.

The trend suggests that crime increased from 2020 through 2022, with a noticeable uptick between 2021 and 2022. This could be due to the COVID-19 lockdown in 2020, when many types of crime were suppressed. As the city reopened and activity returned closer to normal in 2021 and 2022, the daily crime counts rose accordingly.

By 2023, the smoothed curve appears to level off, indicating that crime may have stabilized or begun to decrease relative to the peak around 2022.

```{r}
crime_data %>%
  group_by(date) %>%
  summarise(n = n()) %>%
  ggplot(aes(date, n)) +
  geom_line(color="steelblue", alpha=0.7) +
  geom_smooth() +
  geom_smooth(method="lm", se=FALSE, color="red") +
  labs(
    title = "Daily LA Crimes (2020–2023)",
    x = "Year",
    y = "Daily Crime Reports"
  )
```

Since we see that there is an increase in the number of daily crimes during 2021 sandwiched by two stable periods in 2020 and 2022, a logical comparison would be the mean number of daily crimes in 2020 vs 2022. From what we visually see on the graph, we want to show that $\mu_{2020} < \mu_{2021}$

## 1.5. Inference on mean daily crimes in 2020 vs mean daily crimes in 2022.

- Let $\mu_{2020}$ = the true mean number of crimes per day in 2020
- Let $\mu_{2022}$ = the true mean number of crimes per day in 2022

- Null: $\mu_{2020} = \mu_{2021}$
- Alternative: $\mu_{2020} < \mu_{2021}$

```{r}
# 1. Compute daily crime counts
daily_counts <- crime_data %>%
  group_by(date) %>%
  summarise(n = n()) %>%
  ungroup() %>%
  mutate(year = year(date))

# 2. Pull out the two samples
crime_2020 <- daily_counts %>% filter(year == 2020) %>% pull(n)
crime_2022 <- daily_counts %>% filter(year == 2022) %>% pull(n)

t.test(
  crime_2020,
  crime_2022,
  alternative = "less",
  var.equal = FALSE
)
```

The Welch's t-test returns a p-value of 2.2e-16, so there's significant evidence to suggest that the daily average crime in 2020 was less than that of 2022.  

## 2. Crime by Location (Area) — Which Neighborhoods Are Most Affected?

To understand how crime is distributed geographically, we first examine the total number of reported crimes across LAPD areas. In general, divisions such as 77th Street, Central, and Pacific consistently report the highest volumes of crime.

However, since our main research question focuses on how crime changes over time, we also break this data down to capture yearly dynamics by the color of the bars (2020–2023).

This allows us to easily compare whether crime in each neighborhood has been increasing, decreasing, or remaining stable across the four-year period. For example, most areas show a steady increase from year to year, matching our previous plot, while others such as Central display dramatic rises in crime from 2021 to 2022.

```{r}
crime_yearly <- crime_data %>%
  filter(year %in% c(2020, 2021, 2022, 2023))

crime_yearly %>%
  group_by(AREA.NAME, year) %>%
  summarise(n = n(), .groups = "drop") %>%
  ggplot(aes(x = AREA.NAME, y = n, fill = as.factor(year))) +
  geom_bar(stat = "identity", position = position_dodge()) +
  scale_fill_brewer(palette = "Set2", name = "Year") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(
    title = "Crime Counts by Area",
    x = "Area",
    y = "Crime Count"
  )
```

## 3. Crime by Victim Sex — How Has It Changed Over Time?

To examine gender patterns in crime victims, we look at the number of reported victims by sex (Male vs Female). Again, rather than summarizing all years together, we group incidents by year to see whether the distribution changes over time.

By plotting the yearly counts for male and female victims, we see that the relative proportions remain fairly consistent across the years, with male victims consistently outnumbering female victims. 

```{r}
crime_sex_year <- crime_data %>%
  filter(Vict.Sex %in% c("M", "F")) %>%
  group_by(year, Vict.Sex) %>%
  summarise(n = n(), .groups = "drop")

crime_sex_year %>%
  ggplot(aes(x = year, y = n, fill = Vict.Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_brewer(palette = "Set2") +
  labs(
    x = "Year",
    y = "Reported Victims",
    fill = "Sex",
    title = "Crimes by Victim Sex Across Years"
  )
```

# 3.5 Inference on proportion of male victims in 2020 vs 2022.

Even though the plot showed us that there were always more male victims compared to female victims, we can still conduct a two proportion z-test to see whether the proportion of male victims changed significantly between 2020 and 2022. Visually, we can see that 2020 has slightly more male victims than female victims, so we want to find if $p_{2020} > p{2022}$.

- Let $p_{2020}$ = true proportion of victims who were male in 2020
- Let $p_{2022}$ = true proportion of victims who were male in 2022

- Null: $p_{2020} = p{2022}$
- Alternative: $p_{2020} > p{2022}$

```{r}
# Extract year and filter valid sexes
sex_year <- crime_data %>%
  filter(Vict.Sex %in% c("M", "F")) %>%
  mutate(year = year(date)) %>%
  filter(year %in% c(2020, 2022))

# Count M/F by year
sex_counts <- sex_year %>%
  group_by(year, Vict.Sex) %>%
  summarise(n = n()) %>% ungroup()

# Extract counts
m2020 <- sex_counts$n[sex_counts$year == 2020 & sex_counts$Vict.Sex == "M"]
f2020 <- sex_counts$n[sex_counts$year == 2020 & sex_counts$Vict.Sex == "F"]

m2022 <- sex_counts$n[sex_counts$year == 2022 & sex_counts$Vict.Sex == "M"]
f2022 <- sex_counts$n[sex_counts$year == 2022 & sex_counts$Vict.Sex == "F"]

# Sample proportions
p2020 <- m2020 / (m2020 + f2020)
p2022 <- m2022 / (m2022 + f2022)

prop.test(
  x = c(m2020, m2022),
  n = c(m2020 + f2020, m2022 + f2022),
  alternative = "greater",
  correct = TRUE
)

c(m2020, f2020, m2022, f2022)
```
